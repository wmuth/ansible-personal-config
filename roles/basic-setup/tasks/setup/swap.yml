- name: Create swap file, if doesn't exist using creates
  command: dd if=/dev/zero of=/swapfile bs=1024 count=4096k
           creates=/swapfile

- name: Correct swap permissions
  file:
    path: /swapfile
    owner: root
    group: root
    mode: 0600

- name: Check swap file no double make
  command: file /sawpfile
  register: swapfile-out

- name: Make swap
  command: mkswap /swapfile
  when: swapfile-out.stdout.find('swap file') == -1

- name: Write swap in fstab
  lineinfile:
    dest: /etc/fstab
    regexp: "/swapfile"
    line: "/swapfile none swap sw 0 0"

- name: Swapon
  command: swapon /swapfile
  when: ansible_sawptotal_mb < 1

- name: debug add reminder check
  copy:
    dest: /home/will/reminder-sawp.txt
    content:
      "check that swap exists"
